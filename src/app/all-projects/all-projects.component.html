<div class="row">
    <div class="col-lg-2 col-md-6 col-sm-6 col-6">
        <div class="nameCard">
            <div class="title-heading">
                <h6>Search Customer</h6>
            </div>
        </div>
    </div>
    <div class="col-lg-2 col-md-6 col-sm-6 col-6">
        <div class="searchCard">
            <form [formGroup]="searchForm">
                <input type="text" formControlName="mobile" placeholder="Enter Mobile No/ Name">
            </form>
        </div>
    </div>
    <div class="col-lg-5 col-md-6 col-sm-6 col-6 move-to-new-row">
        <form [formGroup]="dateRangeForm" (ngSubmit)="onDate()" class="search-Form">
            <div class="searchData">
                <div class="details">
                    <label for="startDate"> Start Date</label>
                    <input type="date" formControlName="startDate" id="startDate">
                </div>
                <div class="details">
                    <label for="endDate"> End Date</label>
                    <input type="date" formControlName="endDate" id="endDate">
                </div>
                <div class="details">
                    <button type="submit" class="btn btn-sm btn-primary"> Submit</button>
                </div>
            </div>
        </form>
    </div>
    <div class="col-lg-3 col-md-6 col-sm-6 col-6 move-to-new-row">
        <div class="custom-file-upload">
            <p for="fileInput"> Select File</p>
            <input id="fileInput" type="file" #fileInput (change)="uploadFile($event)">
            <button class="btn btn-sm btn-primary" (click)="selectFile()"> Upload </button>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-12">
        <div class="nameCard2">
            <div class="title-heading">
                <h6>All Projects</h6>
            </div>
            <div class="downloadFile">
                <button class="btn btn-sm btn-success" (click)="downloadFile()"> Download File </button>
            </div>
            <div class="downloadButton" *ngIf="rangeData">
                <button class="btn btn-sm btn-success" (click)="downloadRangeFile()"> Download Selected Data File
                </button>
            </div>
        </div>
        <div *ngIf="customers.length > 0">
            <table class="table">
                <thead class="sticky-header">
                    <tr>
                        <th scope="col">No.</th>
                        <th scope="col">Client Code</th>
                        <th scope="col">Client Name</th>
                        <th scope="col">Mobile Number</th>
                        <th scope="col">Client Business</th>
                        <th scope="col">Project Category</th>
                        <th scope="col">Closing Date</th>
                        <th scope="col">Closing Payment</th>
                        <th scope="col">Amount Received</th>
                        <th scope="col">Remaining Amount</th>
                        <th scope="col">Sales Person</th>
                        <th scope="col">Project Status</th>
                        <th scope="col">Select T.M</th>
                        <th scope="col">T.M Status</th>
                        <th scope="col">Priority</th>
                        <th scope="col">View</th>
                        <th scope="col"> Create Invoice</th>
                    </tr>
                </thead>
                <tbody>
                    <ng-container *ngFor="let user of customers; let i = index">
                        <tr [class.highlighted]="selectedRowIndex === i">
                            <td>
                                <ng-container *ngIf="user.subEntries && user.subEntries.length > 0; else noSub">
                                    <button class="btn btn-link" (click)="user.showSub = !user.showSub">
                                        <span
                                            [ngClass]="{'arrow-down': !user.showSub, 'arrow-up': user.showSub}"></span>
                                    </button>
                                    {{i+1}}
                                </ng-container>
                                <ng-template #noSub>
                                    {{i+1}}
                                </ng-template>
                            </td>
                            <td>{{user.custCode}}</td>
                            <td>{{user.custName}}</td>
                            <td>{{user.custNumb}}<br>{{user.custNumb2}}</td>
                            <td>{{user.custBussiness}}</td>
                            <td>{{user.closingCateg}}</td>
                            <td>{{user.closingDate | date:'dd-MM-yyyy'}}</td>
                            <td>{{user.closingPrice}}</td>
                            <td>{{user.AdvPay + user.restAmount}}</td>
                            <td>{{user.remainingAmount}}</td>
                            <td>{{user.salesPerson}}</td>
                            <td>
                                <select [(ngModel)]="user.projectStatus"
                                    (change)="updateEditorVisible = (user.projectStatus === 'closing'); updateEditors(user); highlightRow(i)">
                                    <option value="Not Interested">Not Interested</option>
                                    <option value="Interested">Interested</option>
                                    <option value="Closing">Closing</option>
                                    <option value="Graphic Designing">Graphic Designing</option>
                                    <option value="Graphic Designing Changes">Graphic Designing Changes</option>
                                    <option value="Scripting">Scripting</option>
                                    <option value="Script Correction">Script Correction</option>
                                    <option value="Voice Over">Voice Over</option>
                                    <option value="Video Editing">Video Editing</option>
                                    <option value="Video Changes">Video Changes</option>
                                    <option value="Video Done">Video Done</option>
                                    <option value="Payment Pending">Payment Pending</option>
                                    <option value="Completed">Completed</option>
                                </select>
                            </td>
                            <td><select *ngIf="user.projectStatus === 'Graphic Designing'"
                                    [(ngModel)]="user.graphicDesigner" (change)="updateEditors(user); highlightRow(i)">
                                    <option value="none">None</option>
                                    <option *ngFor="let employee of filterEmployeesByRole('Graphic Designing')"
                                        [value]="employee.signupUsername">
                                        {{employee.signupUsername}}
                                    </option>
                                </select>
                                <select
                                    *ngIf="user.projectStatus === 'Scripting' || user.projectStatus === 'Script Correction'"
                                    [(ngModel)]="user.scriptWriter" (change)="updateEditors(user); highlightRow(i)">
                                    <option value="none">None</option>
                                    <option *ngFor="let employee of filterEmployeesByRole('Scripting')"
                                        [value]="employee.signupUsername">
                                        {{employee.signupUsername}}
                                    </option>
                                </select>
                                <select
                                    *ngIf="user.projectStatus === 'Video Editing' || user.projectStatus === 'Video Changes' || user.projectStatus === 'Video Done' "
                                    [(ngModel)]="user.editor" (change)="updateEditors(user); highlightRow(i)">
                                    <option value="none">None</option>
                                    <option *ngFor="let employee of filterEmployeesByRole('Video Editing')"
                                        [value]="employee.signupUsername">
                                        {{employee.signupUsername}}
                                    </option>
                                </select>
                                <select *ngIf="user.projectStatus === 'Voice Over'" [(ngModel)]="user.voiceOver"
                                    (change)="updateEditors(user)">
                                    <option value="none">None</option>
                                    <option *ngFor="let employee of filterEmployeesByRole('Voice Over')"
                                        [value]="employee.signupUsername">
                                        {{employee.signupUsername}}
                                    </option>
                                </select>
                            </td>
                            <td *ngIf="user.projectStatus === 'Scripting' || user.projectStatus === 'Script Correction'"
                                [(ngModel)]="user.scriptWriter">
                                {{user.scriptStatus}}
                            </td>
                            <td *ngIf="user.projectStatus === 'Video Editing' || user.projectStatus === 'Video Changes' || user.projectStatus === 'Video Done' "
                                [(ngModel)]="user.editor">
                                {{user.editorStatus}}
                            </td>
                            <td *ngIf="user.projectStatus === 'Voice Over'" [(ngModel)]="user.voiceOver">
                                {{user.voiceOverStatus}}
                            </td>
                            <td *ngIf="user.projectStatus === 'Graphic Designing'" [(ngModel)]="user.graphicDesigner">
                                {{user.graphicStatus}}
                            </td>
                            <td *ngIf="user.projectStatus === 'Closing' || user.projectStatus === 'Completed'">
                                {{user.projectStatus}}
                            </td>
                            <td>
                                <select [(ngModel)]="user.priority" (change)="updatePriority(user,user.priority)">
                                    <option value="none">Select</option>
                                    <option value="Urgent">Urgent</option>
                                    <option value="High">High</option>
                                    <option value="Medium">Medium</option>
                                    <option value="Low">Low</option>
                                </select>
                            </td>
                            <td>
                                <div class="buttons">
                                    <button class="btn btn-sm btn-primary" (click)="openUpdatePanel(user._id)">
                                        View</button>
                                </div>
                            </td>
                            <td> <button class="btn btn-sm btn-primary" (click)="invoice(user._id)">Create</button>
                            </td>
                        </tr>
                        <!-- Sub-entries row -->
                            <tr *ngIf="user.showSub" class="sub-entry-row">
                                <td colspan="19">
                                    <table class="table table-bordered sub-entry-table w-100">
                                        <thead>
                                            <tr>
                                                <th>Sub Code</th>
                                                <th>Name</th>
                                                <th>Type</th>
                                                <th scope="col">Project Status</th>
                                                <th scope="col">Select T.M</th>
                                                <th scope="col">T.M Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let sub of user.subEntries">
                                                <td>{{sub.custCode}}</td>
                                                <td>{{sub.custName}}</td>
                                                <td>{{sub.entryType}}</td>
                                                <td>
                                                    <select [(ngModel)]="sub.projectStatus"
                                                        (change)="updateEditorVisible = (user.projectStatus === 'closing'); updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="Not Interested">Not Interested</option>
                                                        <option value="Interested">Interested</option>
                                                        <option value="Closing">Closing</option>
                                                        <option value="Graphic Designing">Graphic Designing</option>
                                                        <option value="Graphic Designing Changes">Graphic Designing
                                                            Changes</option>
                                                        <option value="Scripting">Scripting</option>
                                                        <option value="Script Correction">Script Correction</option>
                                                        <option value="Voice Over">Voice Over</option>
                                                        <option value="Video Editing">Video Editing</option>
                                                        <option value="Video Changes">Video Changes</option>
                                                        <option value="Video Done">Video Done</option>
                                                        <option value="Payment Pending">Payment Pending</option>
                                                        <option value="Completed">Completed</option>
                                                    </select>
                                                </td>
                                                <td><select *ngIf="sub.projectStatus === 'Graphic Designing'"
                                                        [(ngModel)]="sub.graphicDesigner"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Graphic Designing')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select
                                                        *ngIf="sub.projectStatus === 'Scripting' || sub.projectStatus === 'Script Correction'"
                                                        [(ngModel)]="sub.scriptWriter"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Scripting')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select
                                                        *ngIf="sub.projectStatus === 'Video Editing' || sub.projectStatus === 'Video Changes' || sub.projectStatus === 'Video Done' "
                                                        [(ngModel)]="sub.editor"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Video Editing')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select *ngIf="sub.projectStatus === 'Voice Over'"
                                                        [(ngModel)]="sub.voiceOver"
                                                        (change)="updateSubEntryStatus(user,sub)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Voice Over')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Scripting' || sub.projectStatus === 'Script Correction'"
                                                    [(ngModel)]="sub.scriptWriter">
                                                    {{sub.scriptStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Video Editing' || sub.projectStatus === 'Video Changes' || sub.projectStatus === 'Video Done' "
                                                    [(ngModel)]="sub.editor">
                                                    {{sub.editorStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Voice Over'"
                                                    [(ngModel)]="sub.voiceOver">
                                                    {{sub.voiceOverStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Graphic Designing'"
                                                    [(ngModel)]="sub.graphicDesigner">
                                                    {{sub.graphicStatus}}
                                                </td>
                                                <td
                                                    *ngIf="sub.projectStatus === 'Closing' || sub.projectStatus === 'Completed'">
                                                    {{sub.projectStatus}}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                    </ng-container>
                </tbody>
            </table>
        </div>
        <div class="table-scroll" *ngIf="rangeData">
            <table class="table table-striped">
                <thead class="sticky-header">
                    <tr>
                        <th scope="col">No.</th>
                        <th scope="col">Client Code</th>
                        <th scope="col">Client Name</th>
                        <th scope="col">Mobile Number</th>
                        <th scope="col">Client Business</th>
                        <th scope="col">Project Category</th>
                        <th scope="col">Closing Date</th>
                        <th scope="col">Closing Payment</th>
                        <th scope="col">Amount Received</th>
                        <th scope="col">Remaining Amount</th>
                        <th scope="col">Sales Person</th>
                        <th scope="col">Project Status</th>
                        <th scope="col">Select T.M</th>
                        <th scope="col">T.M Status</th>
                        <th scope="col">Priority</th>
                        <th scope="col">View</th>
                        <th scope="col"> Create Invoice</th>
                    </tr>
                </thead>
                <tbody>
                    <ng-container *ngFor="let user of rangeData; let i = index">
                        <tr>
                        <td>
                            <ng-container *ngIf="user.subEntries && user.subEntries.length > 0; else noSub">
                                <button class="btn btn-link" (click)="user.showSub = !user.showSub">
                                    <span [ngClass]="{'arrow-down': !user.showSub, 'arrow-up': user.showSub}"></span>
                                </button>
                                {{i+1}}
                            </ng-container>
                            <ng-template #noSub>
                                {{i+1}}
                            </ng-template>
                        </td>
                        <td>{{user.custCode}}</td>
                        <td>{{user.custName}}</td>
                        <td>{{user.custNumb}}<br>{{user.custNumb2}}</td>
                        <td>{{user.custBussiness}}</td>
                        <td>{{user.closingCateg}}</td>
                        <td>{{user.closingDate | date:'dd-MM-yyyy'}}</td>
                        <td>{{user.closingPrice}}</td>
                        <td>{{user.AdvPay + user.restAmount}}</td>
                        <td>{{user.remainingAmount}}</td>
                        <td>{{user.salesPerson}}</td>
                        <td>
                            <select [(ngModel)]="user.projectStatus"
                                (change)="updateEditorVisible = (user.projectStatus === 'closing'); updateEditors(user); highlightRow(i)">
                                <option value="Not Interested">Not Interested</option>
                                <option value="Interested">Interested</option>
                                <option value="Closing">Closing</option>
                                <option value="Graphic Designing">Graphic Designing</option>
                                <option value="Graphic Designing Changes">Graphic Designing Changes</option>
                                <option value="Scripting">Scripting</option>
                                <option value="Script Correction">Script Correction</option>
                                <option value="Voice Over">Voice Over</option>
                                <option value="Video Editing">Video Editing</option>
                                <option value="Video Changes">Video Changes</option>
                                <option value="Video Done">Video Done</option>
                                <option value="Payment Pending">Payment Pending</option>
                                <option value="Completed">Completed</option>
                            </select>
                        </td>
                        <td><select *ngIf="user.projectStatus === 'Graphic Designing'"
                                [(ngModel)]="user.graphicDesigner" (change)="updateEditors(user); highlightRow(i)">
                                <option value="none">None</option>
                                <option *ngFor="let employee of filterEmployeesByRole('Graphic Designing')"
                                    [value]="employee.signupUsername">
                                    {{employee.signupUsername}}
                                </option>
                            </select>
                            <select
                                *ngIf="user.projectStatus === 'Scripting' || user.projectStatus === 'Script Correction'"
                                [(ngModel)]="user.scriptWriter" (change)="updateEditors(user); highlightRow(i)">
                                <option value="none">None</option>
                                <option *ngFor="let employee of filterEmployeesByRole('Scripting')"
                                    [value]="employee.signupUsername">
                                    {{employee.signupUsername}}
                                </option>
                            </select>
                            <select
                                *ngIf="user.projectStatus === 'Video Editing' || user.projectStatus === 'Video Changes' || user.projectStatus === 'Video Done' "
                                [(ngModel)]="user.editor" (change)="updateEditors(user); highlightRow(i)">
                                <option value="none">None</option>
                                <option *ngFor="let employee of filterEmployeesByRole('Video Editing')"
                                    [value]="employee.signupUsername">
                                    {{employee.signupUsername}}
                                </option>
                            </select>
                            <select *ngIf="user.projectStatus === 'Voice Over'" [(ngModel)]="user.voiceOver"
                                (change)="updateEditors(user)">
                                <option value="none">None</option>
                                <option *ngFor="let employee of filterEmployeesByRole('Voice Over')"
                                    [value]="employee.signupUsername">
                                    {{employee.signupUsername}}
                                </option>
                            </select>
                        </td>
                        <td *ngIf="user.projectStatus === 'Scripting' || user.projectStatus === 'Script Correction'"
                            [(ngModel)]="user.scriptWriter">
                            {{user.scriptStatus}}
                        </td>
                        <td *ngIf="user.projectStatus === 'Video Editing' || user.projectStatus === 'Video Changes' || user.projectStatus === 'Video Done' "
                            [(ngModel)]="user.editor">
                            {{user.editorStatus}}
                        </td>
                        <td *ngIf="user.projectStatus === 'Voice Over'" [(ngModel)]="user.voiceOver">
                            {{user.voiceOverStatus}}
                        </td>
                        <td *ngIf="user.projectStatus === 'Graphic Designing'" [(ngModel)]="user.graphicDesigner">
                            {{user.graphicStatus}}
                        </td>
                        <td *ngIf="user.projectStatus === 'Closing' || user.projectStatus === 'Completed'">
                            {{user.projectStatus}}
                        </td>
                        <td>
                            <select [(ngModel)]="user.priority" (change)="updatePriority(user,user.priority)">
                                <option value="none">Select</option>
                                <option value="Urgent">Urgent</option>
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </td>
                        <td>
                            <div class="buttons">
                                <button class="btn btn-sm btn-primary" (click)="openUpdatePanel(user._id)">
                                    View</button>
                            </div>
                        </td>
                        <td> <button class="btn btn-sm btn-primary" (click)="invoice(user._id)">Create</button>
                        </td>
                    </tr>
                    <!-- Sub-entries row -->
                            <tr *ngIf="user.showSub" class="sub-entry-row">
                                <td colspan="19">
                                    <table class="table table-bordered sub-entry-table w-100">
                                        <thead>
                                            <tr>
                                                <th>Sub Code</th>
                                                <th>Name</th>
                                                <th>Type</th>
                                                <th scope="col">Project Status</th>
                                                <th scope="col">Select T.M</th>
                                                <th scope="col">T.M Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let sub of user.subEntries">
                                                <td>{{sub.custCode}}</td>
                                                <td>{{sub.custName}}</td>
                                                <td>{{sub.entryType}}</td>
                                                <td>
                                                    <select [(ngModel)]="sub.projectStatus"
                                                        (change)="updateEditorVisible = (user.projectStatus === 'closing'); updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="Not Interested">Not Interested</option>
                                                        <option value="Interested">Interested</option>
                                                        <option value="Closing">Closing</option>
                                                        <option value="Graphic Designing">Graphic Designing</option>
                                                        <option value="Graphic Designing Changes">Graphic Designing
                                                            Changes</option>
                                                        <option value="Scripting">Scripting</option>
                                                        <option value="Script Correction">Script Correction</option>
                                                        <option value="Voice Over">Voice Over</option>
                                                        <option value="Video Editing">Video Editing</option>
                                                        <option value="Video Changes">Video Changes</option>
                                                        <option value="Video Done">Video Done</option>
                                                        <option value="Payment Pending">Payment Pending</option>
                                                        <option value="Completed">Completed</option>
                                                    </select>
                                                </td>
                                                <td><select *ngIf="sub.projectStatus === 'Graphic Designing'"
                                                        [(ngModel)]="sub.graphicDesigner"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Graphic Designing')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select
                                                        *ngIf="sub.projectStatus === 'Scripting' || sub.projectStatus === 'Script Correction'"
                                                        [(ngModel)]="sub.scriptWriter"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Scripting')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select
                                                        *ngIf="sub.projectStatus === 'Video Editing' || sub.projectStatus === 'Video Changes' || sub.projectStatus === 'Video Done' "
                                                        [(ngModel)]="sub.editor"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Video Editing')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select *ngIf="sub.projectStatus === 'Voice Over'"
                                                        [(ngModel)]="sub.voiceOver"
                                                        (change)="updateSubEntryStatus(user,sub)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Voice Over')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Scripting' || sub.projectStatus === 'Script Correction'"
                                                    [(ngModel)]="sub.scriptWriter">
                                                    {{sub.scriptStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Video Editing' || sub.projectStatus === 'Video Changes' || sub.projectStatus === 'Video Done' "
                                                    [(ngModel)]="sub.editor">
                                                    {{sub.editorStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Voice Over'"
                                                    [(ngModel)]="sub.voiceOver">
                                                    {{sub.voiceOverStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Graphic Designing'"
                                                    [(ngModel)]="sub.graphicDesigner">
                                                    {{sub.graphicStatus}}
                                                </td>
                                                <td
                                                    *ngIf="sub.projectStatus === 'Closing' || sub.projectStatus === 'Completed'">
                                                    {{sub.projectStatus}}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                    </ng-container>
                </tbody>
            </table>
        </div>
    </div>
</div>
<!-- <div class="row" *ngIf="pointsUpdate">
    <div class="col-lg-12 col-md-12 col-sm-12 col-12">
        <div class="nameCard">
            <div class="title-heading">
                <h6>Project Points to UPDATE</h6>
            </div>
        </div>
        <div class="table-scroll">
            <table class="table table-striped">
                <thead class="sticky-header">
                    <tr>
                        <th scope="col">No.</th>
                        <th scope="col">Client Name</th>
                        <th scope="col">Business</th>
                        <th scope="col">Closing Date</th>
                        <th scope="col">Closing Category</th>
                        <th scope="col">Duration</th>
                        <th scope="col">Points</th>
                        <th scope="col">Editor Name</th>
                        <th scope="col">Delivery Date</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let user of pointsUpdate; let i = index">
                        <td>{{i+1}}</td>
                        <td>{{user.custName}}</td>
                        <td>{{user.custBussiness}}</td>
                        <td>{{user.closingDate}}</td>
                        <td>{{user.closingCateg}}</td>
                        <td>{{user.videoDurationMinutes || user.b2bVideoDurationMinutes || user.taskVideoDurationMinutes}}:{{user.videoDurationSeconds || user.b2bVideoDurationSeconds || user.taskVideoDurationSeconds}}</td>
                        <td><input type="text" [(ngModel)]="user.pointsEarned" (change)="updatePoints(user)" placeholder="Enter Points"></td>
                        <td>{{user.editor}}</td>
                        <td>{{user.videoDeliveryDate || user.taskDeliveryDate | date:'dd-MM-yyyy'}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div> -->
<div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-12">
        <p class="d-line-flex">
            <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#previousTwoMonth"
                aria-controls="collapseExample">
                {{previousTwoMonthName}}
            </button>
            <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#previousMonth"
                aria-controls="collapseExample">
                {{previousMonthName}}
            </button>
            <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#currentMonth"
                aria-expanded="true" aria-controls="collapseExample">
                {{currentMonthName}}
            </button>
        </p>
        <div class="collapse show" id="currentMonth">
            <div class="table-scroll" *ngIf="this.closingForm.get('closing_name')?.value === 'null'">
                <table class="table table-striped table-responsive">
                    <thead class="sticky-header">
                        <tr>
                            <th scope="col">No.</th>
                            <th scope="col">Client Code</th>
                            <th scope="col">Client Name</th>
                            <th scope="col">Mobile Number</th>
                            <th scope="col">Client Business</th>
                            <th scope="col">
                                <form [formGroup]="closingForm">
                                    <select class="form-select closing_categ-right" formControlName="closing_name"
                                        aria-label="Default select example">
                                        <option value="null">Project Category</option>
                                        <option *ngFor="let camp of allClosings" value="{{camp.categoryName}}">
                                            {{camp.categoryName}}
                                        </option>
                                    </select>
                                </form>
                            </th>
                            <th scope="col">Closing Date</th>
                            <th scope="col">Closing Payment</th>
                            <th scope="col">Amount Received</th>
                            <th scope="col">Remaining Amount</th>
                            <th scope="col">Sales Person</th>
                            <th scope="col">Project Status</th>
                            <th scope="col">Select T.M</th>
                            <th scope="col">T.M Status</th>
                            <th scope="col">Priority</th>
                            <th scope="col">View</th>
                            <th scope="col"> Create Invoice</th>
                        </tr>
                    </thead>
                    <tbody>
                        <ng-container *ngFor="let user of data; let i = index"
                            [class.highlighted]="selectedRowIndex === i">
                            <tr>
                                <td>
                                    <!-- <button class="btn btn-link" (click)="user.showSub = !user.showSub">
                                        <span
                                            [ngClass]="{'arrow-down': !user.showSub, 'arrow-up': user.showSub}"></span>
                                    </button>
                                    {{i+1}} -->
                                    <ng-container *ngIf="user.subEntries && user.subEntries.length > 0; else noSub">
                                        <button class="btn btn-link" (click)="user.showSub = !user.showSub">
                                            <span
                                                [ngClass]="{'arrow-down': !user.showSub, 'arrow-up': user.showSub}"></span>
                                        </button>
                                        {{i+1}}
                                    </ng-container>
                                    <ng-template #noSub>
                                        {{i+1}}
                                    </ng-template>
                                </td>
                                <td>{{user.custCode}}</td>
                                <td>{{user.custName}}</td>
                                <td>{{user.custNumb}}<br>{{user.custNumb2}}</td>
                                <td>{{user.custBussiness}}</td>
                                <td>{{user.closingCateg}}</td>
                                <td>{{user.closingDate | date:'dd-MM-yyyy'}}</td>
                                <td>{{user.closingPrice}}</td>
                                <td>{{user.AdvPay + user.restAmount}}</td>
                                <td>{{user.remainingAmount}}</td>
                                <td>{{user.salesPerson}}</td>
                                <td>
                                    <select [(ngModel)]="user.projectStatus"
                                        (change)="updateEditorVisible = (user.projectStatus === 'closing'); updateEditors(user); highlightRow(i)">
                                        <option value="Not Interested">Not Interested</option>
                                        <option value="Interested">Interested</option>
                                        <option value="Closing">Closing</option>
                                        <option value="Graphic Designing">Graphic Designing</option>
                                        <option value="Graphic Designing Changes">Graphic Designing Changes</option>
                                        <option value="Scripting">Scripting</option>
                                        <option value="Script Correction">Script Correction</option>
                                        <option value="Voice Over">Voice Over</option>
                                        <option value="Video Editing">Video Editing</option>
                                        <option value="Video Changes">Video Changes</option>
                                        <option value="Video Done">Video Done</option>
                                        <option value="Payment Pending">Payment Pending</option>
                                        <option value="Completed">Completed</option>
                                    </select>
                                </td>
                                <td><select *ngIf="user.projectStatus === 'Graphic Designing'"
                                        [(ngModel)]="user.graphicDesigner"
                                        (change)="updateEditors(user); highlightRow(i)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Graphic Designing')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                    <select
                                        *ngIf="user.projectStatus === 'Scripting' || user.projectStatus === 'Script Correction'"
                                        [(ngModel)]="user.scriptWriter" (change)="updateEditors(user); highlightRow(i)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Scripting')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                    <select
                                        *ngIf="user.projectStatus === 'Video Editing' || user.projectStatus === 'Video Changes' || user.projectStatus === 'Video Done' "
                                        [(ngModel)]="user.editor" (change)="updateEditors(user); highlightRow(i)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Video Editing')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                    <select *ngIf="user.projectStatus === 'Voice Over'" [(ngModel)]="user.voiceOver"
                                        (change)="updateEditors(user)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Voice Over')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                </td>
                                <td *ngIf="user.projectStatus === 'Scripting' || user.projectStatus === 'Script Correction'"
                                    [(ngModel)]="user.scriptWriter">
                                    {{user.scriptStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Video Editing' || user.projectStatus === 'Video Changes' || user.projectStatus === 'Video Done' "
                                    [(ngModel)]="user.editor">
                                    {{user.editorStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Voice Over'" [(ngModel)]="user.voiceOver">
                                    {{user.voiceOverStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Graphic Designing'"
                                    [(ngModel)]="user.graphicDesigner">
                                    {{user.graphicStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Closing' || user.projectStatus === 'Completed'">
                                    {{user.projectStatus}}
                                </td>
                                <td>
                                    <select [(ngModel)]="user.priority" (change)="updatePriority(user,user.priority)">
                                        <option value="none">Select</option>
                                        <option value="Urgent">Urgent</option>
                                        <option value="High">High</option>
                                        <option value="Medium">Medium</option>
                                        <option value="Low">Low</option>
                                    </select>
                                </td>
                                <td>
                                    <div class="buttons">
                                        <button class="btn btn-sm btn-primary" (click)="openUpdatePanel(user._id)">
                                            View</button>
                                    </div>
                                </td>
                                <td> <button class="btn btn-sm btn-primary" (click)="invoice(user._id)">Create</button>
                                </td>
                            </tr>
                            <!-- Sub-entries row -->
                            <tr *ngIf="user.showSub" class="sub-entry-row">
                                <td colspan="19">
                                    <table class="table table-bordered sub-entry-table w-100">
                                        <thead>
                                            <tr>
                                                <th>Sub Code</th>
                                                <th>Name</th>
                                                <th>Type</th>
                                                <th scope="col">Project Status</th>
                                                <th scope="col">Select T.M</th>
                                                <th scope="col">T.M Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let sub of user.subEntries">
                                                <td>{{sub.custCode}}</td>
                                                <td>{{sub.custName}}</td>
                                                <td>{{sub.entryType}}</td>
                                                <td>
                                                    <select [(ngModel)]="sub.projectStatus"
                                                        (change)="updateEditorVisible = (user.projectStatus === 'closing'); updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="Not Interested">Not Interested</option>
                                                        <option value="Interested">Interested</option>
                                                        <option value="Closing">Closing</option>
                                                        <option value="Graphic Designing">Graphic Designing</option>
                                                        <option value="Graphic Designing Changes">Graphic Designing
                                                            Changes</option>
                                                        <option value="Scripting">Scripting</option>
                                                        <option value="Script Correction">Script Correction</option>
                                                        <option value="Voice Over">Voice Over</option>
                                                        <option value="Video Editing">Video Editing</option>
                                                        <option value="Video Changes">Video Changes</option>
                                                        <option value="Video Done">Video Done</option>
                                                        <option value="Payment Pending">Payment Pending</option>
                                                        <option value="Completed">Completed</option>
                                                    </select>
                                                </td>
                                                <td><select *ngIf="sub.projectStatus === 'Graphic Designing'"
                                                        [(ngModel)]="sub.graphicDesigner"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Graphic Designing')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select
                                                        *ngIf="sub.projectStatus === 'Scripting' || sub.projectStatus === 'Script Correction'"
                                                        [(ngModel)]="sub.scriptWriter"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Scripting')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select
                                                        *ngIf="sub.projectStatus === 'Video Editing' || sub.projectStatus === 'Video Changes' || sub.projectStatus === 'Video Done' "
                                                        [(ngModel)]="sub.editor"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Video Editing')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select *ngIf="sub.projectStatus === 'Voice Over'"
                                                        [(ngModel)]="sub.voiceOver"
                                                        (change)="updateSubEntryStatus(user,sub)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Voice Over')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Scripting' || sub.projectStatus === 'Script Correction'"
                                                    [(ngModel)]="sub.scriptWriter">
                                                    {{sub.scriptStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Video Editing' || sub.projectStatus === 'Video Changes' || sub.projectStatus === 'Video Done' "
                                                    [(ngModel)]="sub.editor">
                                                    {{sub.editorStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Voice Over'"
                                                    [(ngModel)]="sub.voiceOver">
                                                    {{sub.voiceOverStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Graphic Designing'"
                                                    [(ngModel)]="sub.graphicDesigner">
                                                    {{sub.graphicStatus}}
                                                </td>
                                                <td
                                                    *ngIf="sub.projectStatus === 'Closing' || sub.projectStatus === 'Completed'">
                                                    {{sub.projectStatus}}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </ng-container>
                    </tbody>
                </table>
            </div>
            <div class="table-scroll" *ngIf="this.closingForm.get('closing_name')?.value !== 'null'">
                <table class="table table-striped table-responsive">
                    <thead class="sticky-header">
                        <tr>
                            <th scope="col">No.</th>
                            <th scope="col">Client Code</th>
                            <th scope="col">Client Name</th>
                            <th scope="col">Mobile Number</th>
                            <th scope="col">Client Business</th>
                            <th scope="col">
                                <form [formGroup]="closingForm">
                                    <select class="form-select closing_categ-right" formControlName="closing_name"
                                        aria-label="Default select example">
                                        <option value="null">Project Category</option>
                                        <option *ngFor="let camp of allClosings" value="{{camp.categoryName}}">
                                            {{camp.categoryName}}
                                        </option>
                                    </select>
                                </form>
                            </th>
                            <th scope="col">Closing Date</th>
                            <th scope="col">Closing Payment</th>
                            <th scope="col">Amount Received</th>
                            <th scope="col">Remaining Amount</th>
                            <th scope="col">Sales Person</th>
                            <th scope="col">Project Status</th>
                            <th scope="col">Select T.M</th>
                            <th scope="col">T.M Status</th>
                            <th scope="col">Priority</th>
                            <th scope="col">View</th>
                            <th scope="col"> Create Invoice</th>
                        </tr>
                    </thead>
                    <tbody>
                        <ng-container *ngFor="let user of cloData; let i = index"
                            [class.highlighted]="selectedRowIndex === i">
                            <tr>
                                <td>
                                    <ng-container *ngIf="user.subEntries && user.subEntries.length > 0; else noSub">
                                        <button class="btn btn-link" (click)="user.showSub = !user.showSub">
                                            <span
                                                [ngClass]="{'arrow-down': !user.showSub, 'arrow-up': user.showSub}"></span>
                                        </button>
                                        {{i+1}}
                                    </ng-container>
                                    <ng-template #noSub>
                                        {{i+1}}
                                    </ng-template>
                                </td>
                                <td>{{user.custCode}}</td>
                                <td>{{user.custName}}</td>
                                <td>{{user.custNumb}}<br>{{user.custNumb2}}</td>
                                <td>{{user.custBussiness}}</td>
                                <td>{{user.closingCateg}}</td>
                                <td>{{user.closingDate | date:'dd-MM-yyyy'}}</td>
                                <td>{{user.closingPrice}}</td>
                                <td>{{user.AdvPay + user.restAmount}}</td>
                                <td>{{user.remainingAmount}}</td>
                                <td>{{user.salesPerson}}</td>
                                <td>
                                    <select [(ngModel)]="user.projectStatus"
                                        (change)="updateEditorVisible = (user.projectStatus === 'closing'); updateEditors(user); highlightRow(i)">
                                        <option value="Not Interested">Not Interested</option>
                                        <option value="Interested">Interested</option>
                                        <option value="Closing">Closing</option>
                                        <option value="Graphic Designing">Graphic Designing</option>
                                        <option value="Graphic Designing Changes">Graphic Designing Changes</option>
                                        <option value="Scripting">Scripting</option>
                                        <option value="Script Correction">Script Correction</option>
                                        <option value="Voice Over">Voice Over</option>
                                        <option value="Video Editing">Video Editing</option>
                                        <option value="Video Changes">Video Changes</option>
                                        <option value="Video Done">Video Done</option>
                                        <option value="Payment Pending">Payment Pending</option>
                                        <option value="Completed">Completed</option>
                                    </select>
                                </td>
                                <td><select *ngIf="user.projectStatus === 'Graphic Designing'"
                                        [(ngModel)]="user.graphicDesigner"
                                        (change)="updateEditors(user); highlightRow(i)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Graphic Designing')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                    <select
                                        *ngIf="user.projectStatus === 'Scripting' || user.projectStatus === 'Script Correction'"
                                        [(ngModel)]="user.scriptWriter" (change)="updateEditors(user); highlightRow(i)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Scripting')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                    <select
                                        *ngIf="user.projectStatus === 'Video Editing' || user.projectStatus === 'Video Changes' || user.projectStatus === 'Video Done' "
                                        [(ngModel)]="user.editor" (change)="updateEditors(user); highlightRow(i)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Video Editing')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                    <select *ngIf="user.projectStatus === 'Voice Over'" [(ngModel)]="user.voiceOver"
                                        (change)="updateEditors(user)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Voice Over')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                </td>
                                <td *ngIf="user.projectStatus === 'Scripting' || user.projectStatus === 'Script Correction'"
                                    [(ngModel)]="user.scriptWriter">
                                    {{user.scriptStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Video Editing' || user.projectStatus === 'Video Changes' || user.projectStatus === 'Video Done' "
                                    [(ngModel)]="user.editor">
                                    {{user.editorStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Voice Over'" [(ngModel)]="user.voiceOver">
                                    {{user.voiceOverStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Graphic Designing'"
                                    [(ngModel)]="user.graphicDesigner">
                                    {{user.graphicStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Closing' || user.projectStatus === 'Completed'">
                                    {{user.projectStatus}}
                                </td>
                                <td>
                                    <select [(ngModel)]="user.priority" (change)="updatePriority(user,user.priority)">
                                        <option value="none">Select</option>
                                        <option value="Urgent">Urgent</option>
                                        <option value="High">High</option>
                                        <option value="Medium">Medium</option>
                                        <option value="Low">Low</option>
                                    </select>
                                </td>
                                <td>
                                    <div class="buttons">
                                        <button class="btn btn-sm btn-primary" (click)="openUpdatePanel(user._id)">
                                            View</button>
                                    </div>
                                </td>
                                <td> <button class="btn btn-sm btn-primary" (click)="invoice(user._id)">Create</button>
                                </td>
                            </tr>
                            <!-- Sub-entries row -->
                            <tr *ngIf="user.showSub" class="sub-entry-row">
                                <td colspan="19">
                                    <table class="table table-bordered sub-entry-table w-100">
                                        <thead>
                                            <tr>
                                                <th>Sub Code</th>
                                                <th>Name</th>
                                                <th>Type</th>
                                                <th scope="col">Project Status</th>
                                                <th scope="col">Select T.M</th>
                                                <th scope="col">T.M Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let sub of user.subEntries">
                                                <td>{{sub.custCode}}</td>
                                                <td>{{sub.custName}}</td>
                                                <td>{{sub.entryType}}</td>
                                                <td>
                                                    <select [(ngModel)]="sub.projectStatus"
                                                        (change)="updateEditorVisible = (user.projectStatus === 'closing'); updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="Not Interested">Not Interested</option>
                                                        <option value="Interested">Interested</option>
                                                        <option value="Closing">Closing</option>
                                                        <option value="Graphic Designing">Graphic Designing</option>
                                                        <option value="Graphic Designing Changes">Graphic Designing
                                                            Changes</option>
                                                        <option value="Scripting">Scripting</option>
                                                        <option value="Script Correction">Script Correction</option>
                                                        <option value="Voice Over">Voice Over</option>
                                                        <option value="Video Editing">Video Editing</option>
                                                        <option value="Video Changes">Video Changes</option>
                                                        <option value="Video Done">Video Done</option>
                                                        <option value="Payment Pending">Payment Pending</option>
                                                        <option value="Completed">Completed</option>
                                                    </select>
                                                </td>
                                                <td><select *ngIf="sub.projectStatus === 'Graphic Designing'"
                                                        [(ngModel)]="sub.graphicDesigner"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Graphic Designing')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select
                                                        *ngIf="sub.projectStatus === 'Scripting' || sub.projectStatus === 'Script Correction'"
                                                        [(ngModel)]="sub.scriptWriter"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Scripting')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select
                                                        *ngIf="sub.projectStatus === 'Video Editing' || sub.projectStatus === 'Video Changes' || sub.projectStatus === 'Video Done' "
                                                        [(ngModel)]="sub.editor"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Video Editing')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select *ngIf="sub.projectStatus === 'Voice Over'"
                                                        [(ngModel)]="sub.voiceOver"
                                                        (change)="updateSubEntryStatus(user,sub)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Voice Over')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Scripting' || sub.projectStatus === 'Script Correction'"
                                                    [(ngModel)]="sub.scriptWriter">
                                                    {{sub.scriptStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Video Editing' || sub.projectStatus === 'Video Changes' || sub.projectStatus === 'Video Done' "
                                                    [(ngModel)]="sub.editor">
                                                    {{sub.editorStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Voice Over'"
                                                    [(ngModel)]="sub.voiceOver">
                                                    {{sub.voiceOverStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Graphic Designing'"
                                                    [(ngModel)]="sub.graphicDesigner">
                                                    {{sub.graphicStatus}}
                                                </td>
                                                <td
                                                    *ngIf="sub.projectStatus === 'Closing' || sub.projectStatus === 'Completed'">
                                                    {{sub.projectStatus}}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </ng-container>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="collapse" id="previousMonth">
            <div class="table-scroll" *ngIf="this.closingForm.get('closing_name')?.value === 'null'">
                <div class="table table-striped table-responsive">
                    <thead class="sticky-header">
                        <tr>
                            <th scope="col">No.</th>
                            <th scope="col">Client Code</th>
                            <th scope="col">Client Name</th>
                            <th scope="col">Mobile Number</th>
                            <th scope="col">Client Business</th>
                            <th scope="col">
                                <form [formGroup]="closingForm">
                                    <select class="form-select closing_categ-right" formControlName="closing_name"
                                        aria-label="Default select example">
                                        <option value="null">Project Category</option>
                                        <option *ngFor="let camp of allClosings" value="{{camp.categoryName}}">
                                            {{camp.categoryName}}
                                        </option>
                                    </select>
                                </form>
                            </th>
                            <th scope="col">Closing Date</th>
                            <th scope="col">Closing Payment</th>
                            <th scope="col">Amount Received</th>
                            <th scope="col">Remaining Amount</th>
                            <th scope="col">Sales Person</th>
                            <th scope="col">Project Status</th>
                            <th scope="col">Select T.M</th>
                            <th scope="col">T.M Status</th>
                            <th scope="col">Priority</th>
                            <th scope="col">View</th>
                            <th scope="col"> Create Invoice</th>
                        </tr>
                    </thead>
                    <tbody>
                        <ng-container *ngFor="let user of Previousdata; let i = index"
                            [class.highlighted]="selectedRowIndex === i">
                            <tr>
                                <td>
                                    <ng-container *ngIf="user.subEntries && user.subEntries.length > 0; else noSub">
                                        <button class="btn btn-link" (click)="user.showSub = !user.showSub">
                                            <span
                                                [ngClass]="{'arrow-down': !user.showSub, 'arrow-up': user.showSub}"></span>
                                        </button>
                                        {{i+1}}
                                    </ng-container>
                                    <ng-template #noSub>
                                        {{i+1}}
                                    </ng-template>
                                </td>
                                <td>{{user.custCode}}</td>
                                <td>{{user.custName}}</td>
                                <td>{{user.custNumb}}<br>{{user.custNumb2}}</td>
                                <td>{{user.custBussiness}}</td>
                                <td>{{user.closingCateg}}</td>
                                <td>{{user.closingDate | date:'dd-MM-yyyy'}}</td>
                                <td>{{user.closingPrice}}</td>
                                <td>{{user.AdvPay + user.restAmount}}</td>
                                <td>{{user.remainingAmount}}</td>
                                <td>{{user.salesPerson}}</td>
                                <td>
                                    <select [(ngModel)]="user.projectStatus"
                                        (change)="updateEditorVisible = (user.projectStatus === 'closing'); updateEditors(user); highlightRow(i)">
                                        <option value="Not Interested">Not Interested</option>
                                        <option value="Interested">Interested</option>
                                        <option value="Closing">Closing</option>
                                        <option value="Scripting">Scripting</option>
                                        <option value="Script Correction">Script Correction</option>
                                        <option value="Voice Over">Voice Over</option>
                                        <option value="Video Editing">Video Editing</option>
                                        <option value="Video Changes">Video Changes</option>
                                        <option value="Video Done">Video Done</option>
                                        <option value="Payment Pending">Payment Pending</option>
                                        <option value="Completed">Completed</option>
                                    </select>
                                </td>
                                <td>
                                    <select
                                        *ngIf="user.projectStatus === 'Scripting' || user.projectStatus === 'Script Correction'"
                                        [(ngModel)]="user.scriptWriter" (change)="updateEditors(user)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Scripting')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                    <select
                                        *ngIf="user.projectStatus === 'Video Editing' || user.projectStatus === 'Video Changes' || user.projectStatus === 'Video Done' "
                                        [(ngModel)]="user.editor" (change)="updateEditors(user)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Video Editing')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                    <select *ngIf="user.projectStatus === 'Voice Over'" [(ngModel)]="user.voiceOver"
                                        (change)="updateEditors(user)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Voice Over')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                </td>
                                <td *ngIf="user.projectStatus === 'Scripting' || user.projectStatus === 'Script Correction'"
                                    [(ngModel)]="user.scriptWriter">
                                    {{user.scriptStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Video Editing' || user.projectStatus === 'Video Changes' || user.projectStatus === 'Video Done' "
                                    [(ngModel)]="user.editor">
                                    {{user.editorStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Voice Over'" [(ngModel)]="user.voiceOver">
                                    {{user.voiceOverStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Closing' || user.projectStatus === 'Completed'">
                                    {{user.projectStatus}}
                                </td>
                                <td>
                                    <select [(ngModel)]="user.priority" (change)="updatePriority(user,user.priority)">
                                        <option value="none">Select</option>
                                        <option value="Urgent">Urgent</option>
                                        <option value="High">High</option>
                                        <option value="Medium">Medium</option>
                                        <option value="Low">Low</option>
                                    </select>
                                </td>
                                <td>
                                    <div class="buttons">
                                        <button class="btn btn-sm btn-primary" (click)="openUpdatePanel(user._id)">
                                            View</button>
                                    </div>
                                </td>
                                <td> <button class="btn btn-sm btn-primary" (click)="invoice(user._id)">Create</button>
                                </td>
                            </tr>
                            <!-- Sub-entries row -->
                            <tr *ngIf="user.showSub" class="sub-entry-row">
                                <td colspan="19">
                                    <table class="table table-bordered sub-entry-table w-100">
                                        <thead>
                                            <tr>
                                                <th>Sub Code</th>
                                                <th>Name</th>
                                                <th>Type</th>
                                                <th scope="col">Project Status</th>
                                                <th scope="col">Select T.M</th>
                                                <th scope="col">T.M Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let sub of user.subEntries">
                                                <td>{{sub.custCode}}</td>
                                                <td>{{sub.custName}}</td>
                                                <td>{{sub.entryType}}</td>
                                                <td>
                                                    <select [(ngModel)]="sub.projectStatus"
                                                        (change)="updateEditorVisible = (user.projectStatus === 'closing'); updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="Not Interested">Not Interested</option>
                                                        <option value="Interested">Interested</option>
                                                        <option value="Closing">Closing</option>
                                                        <option value="Graphic Designing">Graphic Designing</option>
                                                        <option value="Graphic Designing Changes">Graphic Designing
                                                            Changes</option>
                                                        <option value="Scripting">Scripting</option>
                                                        <option value="Script Correction">Script Correction</option>
                                                        <option value="Voice Over">Voice Over</option>
                                                        <option value="Video Editing">Video Editing</option>
                                                        <option value="Video Changes">Video Changes</option>
                                                        <option value="Video Done">Video Done</option>
                                                        <option value="Payment Pending">Payment Pending</option>
                                                        <option value="Completed">Completed</option>
                                                    </select>
                                                </td>
                                                <td><select *ngIf="sub.projectStatus === 'Graphic Designing'"
                                                        [(ngModel)]="sub.graphicDesigner"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Graphic Designing')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select
                                                        *ngIf="sub.projectStatus === 'Scripting' || sub.projectStatus === 'Script Correction'"
                                                        [(ngModel)]="sub.scriptWriter"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Scripting')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select
                                                        *ngIf="sub.projectStatus === 'Video Editing' || sub.projectStatus === 'Video Changes' || sub.projectStatus === 'Video Done' "
                                                        [(ngModel)]="sub.editor"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Video Editing')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select *ngIf="sub.projectStatus === 'Voice Over'"
                                                        [(ngModel)]="sub.voiceOver"
                                                        (change)="updateSubEntryStatus(user,sub)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Voice Over')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Scripting' || sub.projectStatus === 'Script Correction'"
                                                    [(ngModel)]="sub.scriptWriter">
                                                    {{sub.scriptStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Video Editing' || sub.projectStatus === 'Video Changes' || sub.projectStatus === 'Video Done' "
                                                    [(ngModel)]="sub.editor">
                                                    {{sub.editorStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Voice Over'"
                                                    [(ngModel)]="sub.voiceOver">
                                                    {{sub.voiceOverStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Graphic Designing'"
                                                    [(ngModel)]="sub.graphicDesigner">
                                                    {{sub.graphicStatus}}
                                                </td>
                                                <td
                                                    *ngIf="sub.projectStatus === 'Closing' || sub.projectStatus === 'Completed'">
                                                    {{sub.projectStatus}}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </ng-container>
                    </tbody>
                </div>
            </div>
            <div class="table-scroll" *ngIf="this.closingForm.get('closing_name')?.value !== 'null'">
                <div class="table table-striped table-responsive">
                    <thead class="sticky-header">
                        <tr>
                            <th scope="col">No.</th>
                            <th scope="col">Client Code</th>
                            <th scope="col">Client Name</th>
                            <th scope="col">Mobile Number</th>
                            <th scope="col">Client Business</th>
                            <th scope="col">
                                <form [formGroup]="closingForm">
                                    <select class="form-select closing_categ-right" formControlName="closing_name"
                                        aria-label="Default select example">
                                        <option value="null">Project Category</option>
                                        <option *ngFor="let camp of allClosings" value="{{camp.categoryName}}">
                                            {{camp.categoryName}}
                                        </option>
                                    </select>
                                </form>
                            </th>
                            <th scope="col">Closing Date</th>
                            <th scope="col">Closing Payment</th>
                            <th scope="col">Amount Received</th>
                            <th scope="col">Remaining Amount</th>
                            <th scope="col">Sales Person</th>
                            <th scope="col">Project Status</th>
                            <th scope="col">Select T.M</th>
                            <th scope="col">T.M Status</th>
                            <th scope="col">Priority</th>
                            <th scope="col">View</th>
                            <th scope="col"> Create Invoice</th>
                        </tr>
                    </thead>
                    <tbody>
                        <ng-container *ngFor="let user of cloDataPrev; let i = index"
                            [class.highlighted]="selectedRowIndex === i">
                            <tr>
                                <td>
                                    <ng-container *ngIf="user.subEntries && user.subEntries.length > 0; else noSub">
                                        <button class="btn btn-link" (click)="user.showSub = !user.showSub">
                                            <span
                                                [ngClass]="{'arrow-down': !user.showSub, 'arrow-up': user.showSub}"></span>
                                        </button>
                                        {{i+1}}
                                    </ng-container>
                                    <ng-template #noSub>
                                        {{i+1}}
                                    </ng-template>
                                </td>
                                <td>{{user.custCode}}</td>
                                <td>{{user.custName}}</td>
                                <td>{{user.custNumb}}<br>{{user.custNumb2}}</td>
                                <td>{{user.custBussiness}}</td>
                                <td>{{user.closingCateg}}</td>
                                <td>{{user.closingDate | date:'dd-MM-yyyy'}}</td>
                                <td>{{user.closingPrice}}</td>
                                <td>{{user.AdvPay + user.restAmount}}</td>
                                <td>{{user.remainingAmount}}</td>
                                <td>{{user.salesPerson}}</td>
                                <td>
                                    <select [(ngModel)]="user.projectStatus"
                                        (change)="updateEditorVisible = (user.projectStatus === 'closing'); updateEditors(user); highlightRow(i)">
                                        <option value="Not Interested">Not Interested</option>
                                        <option value="Interested">Interested</option>
                                        <option value="Closing">Closing</option>
                                        <option value="Scripting">Scripting</option>
                                        <option value="Script Correction">Script Correction</option>
                                        <option value="Voice Over">Voice Over</option>
                                        <option value="Video Editing">Video Editing</option>
                                        <option value="Video Changes">Video Changes</option>
                                        <option value="Video Done">Video Done</option>
                                        <option value="Payment Pending">Payment Pending</option>
                                        <option value="Completed">Completed</option>
                                    </select>
                                </td>
                                <td>
                                    <select
                                        *ngIf="user.projectStatus === 'Scripting' || user.projectStatus === 'Script Correction'"
                                        [(ngModel)]="user.scriptWriter" (change)="updateEditors(user)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Scripting')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                    <select
                                        *ngIf="user.projectStatus === 'Video Editing' || user.projectStatus === 'Video Changes' || user.projectStatus === 'Video Done' "
                                        [(ngModel)]="user.editor" (change)="updateEditors(user)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Video Editing')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                    <select *ngIf="user.projectStatus === 'Voice Over'" [(ngModel)]="user.voiceOver"
                                        (change)="updateEditors(user)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Voice Over')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                </td>
                                <td *ngIf="user.projectStatus === 'Scripting' || user.projectStatus === 'Script Correction'"
                                    [(ngModel)]="user.scriptWriter">
                                    {{user.scriptStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Video Editing' || user.projectStatus === 'Video Changes' || user.projectStatus === 'Video Done' "
                                    [(ngModel)]="user.editor">
                                    {{user.editorStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Voice Over'" [(ngModel)]="user.voiceOver">
                                    {{user.voiceOverStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Closing' || user.projectStatus === 'Completed'">
                                    {{user.projectStatus}}
                                </td>
                                <td>
                                    <select [(ngModel)]="user.priority" (change)="updatePriority(user,user.priority)">
                                        <option value="none">Select</option>
                                        <option value="Urgent">Urgent</option>
                                        <option value="High">High</option>
                                        <option value="Medium">Medium</option>
                                        <option value="Low">Low</option>
                                    </select>
                                </td>
                                <td>
                                    <div class="buttons">
                                        <button class="btn btn-sm btn-primary" (click)="openUpdatePanel(user._id)">
                                            View</button>
                                    </div>
                                </td>
                                <td> <button class="btn btn-sm btn-primary" (click)="invoice(user._id)">Create</button>
                                </td>
                            </tr>
                            <!-- Sub-entries row -->
                            <tr *ngIf="user.showSub" class="sub-entry-row">
                                <td colspan="19">
                                    <table class="table table-bordered sub-entry-table w-100">
                                        <thead>
                                            <tr>
                                                <th>Sub Code</th>
                                                <th>Name</th>
                                                <th>Type</th>
                                                <th scope="col">Project Status</th>
                                                <th scope="col">Select T.M</th>
                                                <th scope="col">T.M Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let sub of user.subEntries">
                                                <td>{{sub.custCode}}</td>
                                                <td>{{sub.custName}}</td>
                                                <td>{{sub.entryType}}</td>
                                                <td>
                                                    <select [(ngModel)]="sub.projectStatus"
                                                        (change)="updateEditorVisible = (user.projectStatus === 'closing'); updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="Not Interested">Not Interested</option>
                                                        <option value="Interested">Interested</option>
                                                        <option value="Closing">Closing</option>
                                                        <option value="Graphic Designing">Graphic Designing</option>
                                                        <option value="Graphic Designing Changes">Graphic Designing
                                                            Changes</option>
                                                        <option value="Scripting">Scripting</option>
                                                        <option value="Script Correction">Script Correction</option>
                                                        <option value="Voice Over">Voice Over</option>
                                                        <option value="Video Editing">Video Editing</option>
                                                        <option value="Video Changes">Video Changes</option>
                                                        <option value="Video Done">Video Done</option>
                                                        <option value="Payment Pending">Payment Pending</option>
                                                        <option value="Completed">Completed</option>
                                                    </select>
                                                </td>
                                                <td><select *ngIf="sub.projectStatus === 'Graphic Designing'"
                                                        [(ngModel)]="sub.graphicDesigner"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Graphic Designing')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select
                                                        *ngIf="sub.projectStatus === 'Scripting' || sub.projectStatus === 'Script Correction'"
                                                        [(ngModel)]="sub.scriptWriter"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Scripting')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select
                                                        *ngIf="sub.projectStatus === 'Video Editing' || sub.projectStatus === 'Video Changes' || sub.projectStatus === 'Video Done' "
                                                        [(ngModel)]="sub.editor"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Video Editing')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select *ngIf="sub.projectStatus === 'Voice Over'"
                                                        [(ngModel)]="sub.voiceOver"
                                                        (change)="updateSubEntryStatus(user,sub)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Voice Over')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Scripting' || sub.projectStatus === 'Script Correction'"
                                                    [(ngModel)]="sub.scriptWriter">
                                                    {{sub.scriptStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Video Editing' || sub.projectStatus === 'Video Changes' || sub.projectStatus === 'Video Done' "
                                                    [(ngModel)]="sub.editor">
                                                    {{sub.editorStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Voice Over'"
                                                    [(ngModel)]="sub.voiceOver">
                                                    {{sub.voiceOverStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Graphic Designing'"
                                                    [(ngModel)]="sub.graphicDesigner">
                                                    {{sub.graphicStatus}}
                                                </td>
                                                <td
                                                    *ngIf="sub.projectStatus === 'Closing' || sub.projectStatus === 'Completed'">
                                                    {{sub.projectStatus}}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </ng-container>
                    </tbody>
                </div>
            </div>
        </div>
        <div class="collapse" id="previousTwoMonth">
            <div class="table-scroll" *ngIf="this.closingForm.get('closing_name')?.value === 'null'">
                <div class="table table-striped table-responsive">
                    <thead class="sticky-header">
                        <tr>
                            <th scope="col">No.</th>
                            <th scope="col">Client Code</th>
                            <th scope="col">Client Name</th>
                            <th scope="col">Mobile Number</th>
                            <th scope="col">Client Business</th>
                            <th scope="col">
                                <form [formGroup]="closingForm">
                                    <select class="form-select closing_categ-right" formControlName="closing_name"
                                        aria-label="Default select example">
                                        <option value="null">Project Category</option>
                                        <option *ngFor="let camp of allClosings" value="{{camp.categoryName}}">
                                            {{camp.categoryName}}
                                        </option>
                                    </select>
                                </form>
                            </th>
                            <th scope="col">Closing Date</th>
                            <th scope="col">Closing Payment</th>
                            <th scope="col">Amount Received</th>
                            <th scope="col">Remaining Amount</th>
                            <th scope="col">Sales Person</th>
                            <th scope="col">Project Status</th>
                            <th scope="col">Select T.M</th>
                            <th scope="col">T.M Status</th>
                            <th scope="col">Priority</th>
                            <th scope="col">View</th>
                            <th scope="col"> Create Invoice</th>
                        </tr>
                    </thead>
                    <tbody>
                        <ng-container *ngFor="let user of TwoPreviousdata; let i = index"
                            [class.highlighted]="selectedRowIndex === i">
                            <tr>
                                <td>
                                    <ng-container *ngIf="user.subEntries && user.subEntries.length > 0; else noSub">
                                        <button class="btn btn-link" (click)="user.showSub = !user.showSub">
                                            <span
                                                [ngClass]="{'arrow-down': !user.showSub, 'arrow-up': user.showSub}"></span>
                                        </button>
                                        {{i+1}}
                                    </ng-container>
                                    <ng-template #noSub>
                                        {{i+1}}
                                    </ng-template>
                                </td>
                                <td>{{user.custCode}}</td>
                                <td>{{user.custName}}</td>
                                <td>{{user.custNumb}}<br>{{user.custNumb2}}</td>
                                <td>{{user.custBussiness}}</td>
                                <td>{{user.closingCateg}}</td>
                                <td>{{user.closingDate | date:'dd-MM-yyyy'}}</td>
                                <td>{{user.closingPrice}}</td>
                                <td>{{user.AdvPay + user.restAmount}}</td>
                                <td>{{user.remainingAmount}}</td>
                                <td>{{user.salesPerson}}</td>
                                <td>
                                    <select [(ngModel)]="user.projectStatus"
                                        (change)="updateEditorVisible = (user.projectStatus === 'closing'); updateEditors(user); highlightRow(i)">
                                        <option value="Not Interested">Not Interested</option>
                                        <option value="Interested">Interested</option>
                                        <option value="Closing">Closing</option>
                                        <option value="Scripting">Scripting</option>
                                        <option value="Script Correction">Script Correction</option>
                                        <option value="Voice Over">Voice Over</option>
                                        <option value="Video Editing">Video Editing</option>
                                        <option value="Video Changes">Video Changes</option>
                                        <option value="Video Done">Video Done</option>
                                        <option value="Payment Pending">Payment Pending</option>
                                        <option value="Completed">Completed</option>
                                    </select>
                                </td>
                                <td>
                                    <select
                                        *ngIf="user.projectStatus === 'Scripting' || user.projectStatus === 'Script Correction'"
                                        [(ngModel)]="user.scriptWriter" (change)="updateEditors(user)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Scripting')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                    <select
                                        *ngIf="user.projectStatus === 'Video Editing' || user.projectStatus === 'Video Changes' || user.projectStatus === 'Video Done' "
                                        [(ngModel)]="user.editor" (change)="updateEditors(user)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Video Editing')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                    <select *ngIf="user.projectStatus === 'Voice Over'" [(ngModel)]="user.voiceOver"
                                        (change)="updateEditors(user)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Voice Over')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                </td>
                                <td *ngIf="user.projectStatus === 'Scripting' || user.projectStatus === 'Script Correction'"
                                    [(ngModel)]="user.scriptWriter">
                                    {{user.scriptStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Video Editing' || user.projectStatus === 'Video Changes' || user.projectStatus === 'Video Done' "
                                    [(ngModel)]="user.editor">
                                    {{user.editorStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Voice Over'" [(ngModel)]="user.voiceOver">
                                    {{user.voiceOverStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Closing' || user.projectStatus === 'Completed'">
                                    {{user.projectStatus}}
                                </td>
                                <td>
                                    <select [(ngModel)]="user.priority" (change)="updatePriority(user,user.priority)">
                                        <option value="none">Select</option>
                                        <option value="Urgent">Urgent</option>
                                        <option value="High">High</option>
                                        <option value="Medium">Medium</option>
                                        <option value="Low">Low</option>
                                    </select>
                                </td>

                                <td>
                                    <div class="buttons">
                                        <button class="btn btn-sm btn-primary" (click)="openUpdatePanel(user._id)">
                                            View</button>
                                    </div>
                                </td>
                                <td> <button class="btn btn-sm btn-primary" (click)="invoice(user._id)">Create</button>
                                </td>
                            </tr>
                            <!-- Sub-entries row -->
                            <tr *ngIf="user.showSub" class="sub-entry-row">
                                <td colspan="19">
                                    <table class="table table-bordered sub-entry-table w-100">
                                        <thead>
                                            <tr>
                                                <th>Sub Code</th>
                                                <th>Name</th>
                                                <th>Type</th>
                                                <th scope="col">Project Status</th>
                                                <th scope="col">Select T.M</th>
                                                <th scope="col">T.M Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let sub of user.subEntries">
                                                <td>{{sub.custCode}}</td>
                                                <td>{{sub.custName}}</td>
                                                <td>{{sub.entryType}}</td>
                                                <td>
                                                    <select [(ngModel)]="sub.projectStatus"
                                                        (change)="updateEditorVisible = (user.projectStatus === 'closing'); updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="Not Interested">Not Interested</option>
                                                        <option value="Interested">Interested</option>
                                                        <option value="Closing">Closing</option>
                                                        <option value="Graphic Designing">Graphic Designing</option>
                                                        <option value="Graphic Designing Changes">Graphic Designing
                                                            Changes</option>
                                                        <option value="Scripting">Scripting</option>
                                                        <option value="Script Correction">Script Correction</option>
                                                        <option value="Voice Over">Voice Over</option>
                                                        <option value="Video Editing">Video Editing</option>
                                                        <option value="Video Changes">Video Changes</option>
                                                        <option value="Video Done">Video Done</option>
                                                        <option value="Payment Pending">Payment Pending</option>
                                                        <option value="Completed">Completed</option>
                                                    </select>
                                                </td>
                                                <td><select *ngIf="sub.projectStatus === 'Graphic Designing'"
                                                        [(ngModel)]="sub.graphicDesigner"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Graphic Designing')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select
                                                        *ngIf="sub.projectStatus === 'Scripting' || sub.projectStatus === 'Script Correction'"
                                                        [(ngModel)]="sub.scriptWriter"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Scripting')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select
                                                        *ngIf="sub.projectStatus === 'Video Editing' || sub.projectStatus === 'Video Changes' || sub.projectStatus === 'Video Done' "
                                                        [(ngModel)]="sub.editor"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Video Editing')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select *ngIf="sub.projectStatus === 'Voice Over'"
                                                        [(ngModel)]="sub.voiceOver"
                                                        (change)="updateSubEntryStatus(user,sub)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Voice Over')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Scripting' || sub.projectStatus === 'Script Correction'"
                                                    [(ngModel)]="sub.scriptWriter">
                                                    {{sub.scriptStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Video Editing' || sub.projectStatus === 'Video Changes' || sub.projectStatus === 'Video Done' "
                                                    [(ngModel)]="sub.editor">
                                                    {{sub.editorStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Voice Over'"
                                                    [(ngModel)]="sub.voiceOver">
                                                    {{sub.voiceOverStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Graphic Designing'"
                                                    [(ngModel)]="sub.graphicDesigner">
                                                    {{sub.graphicStatus}}
                                                </td>
                                                <td
                                                    *ngIf="sub.projectStatus === 'Closing' || sub.projectStatus === 'Completed'">
                                                    {{sub.projectStatus}}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </ng-container>
                    </tbody>
                </div>
            </div>
            <div class="table-scroll" *ngIf="this.closingForm.get('closing_name')?.value !== 'null'">
                <div class="table table-striped table-responsive">
                    <thead class="sticky-header">
                        <tr>
                            <th scope="col">No.</th>
                            <th scope="col">Client Code</th>
                            <th scope="col">Client Name</th>
                            <th scope="col">Mobile Number</th>
                            <th scope="col">Client Business</th>
                            <th scope="col">
                                <form [formGroup]="closingForm">
                                    <select class="form-select closing_categ-right" formControlName="closing_name"
                                        aria-label="Default select example">
                                        <option value="null">Project Category</option>
                                        <option *ngFor="let camp of allClosings" value="{{camp.categoryName}}">
                                            {{camp.categoryName}}
                                        </option>
                                    </select>
                                </form>
                            </th>
                            <th scope="col">Closing Date</th>
                            <th scope="col">Closing Payment</th>
                            <th scope="col">Amount Received</th>
                            <th scope="col">Remaining Amount</th>
                            <th scope="col">Sales Person</th>
                            <th scope="col">Project Status</th>
                            <th scope="col">Select T.M</th>
                            <th scope="col">T.M Status</th>
                            <th scope="col">Priority</th>
                            <th scope="col">View</th>
                            <th scope="col"> Create Invoice</th>
                        </tr>
                    </thead>
                    <tbody>
                        <ng-container *ngFor="let user of cloTwoDataPrev; let i = index"
                            [class.highlighted]="selectedRowIndex === i">
                            <tr>
                                <td>
                                    <ng-container *ngIf="user.subEntries && user.subEntries.length > 0; else noSub">
                                        <button class="btn btn-link" (click)="user.showSub = !user.showSub">
                                            <span
                                                [ngClass]="{'arrow-down': !user.showSub, 'arrow-up': user.showSub}"></span>
                                        </button>
                                        {{i+1}}
                                    </ng-container>
                                    <ng-template #noSub>
                                        {{i+1}}
                                    </ng-template>
                                </td>
                                <td>{{user.custCode}}</td>
                                <td>{{user.custName}}</td>
                                <td>{{user.custNumb}}<br>{{user.custNumb2}}</td>
                                <td>{{user.custBussiness}}</td>
                                <td>{{user.closingCateg}}</td>
                                <td>{{user.closingDate | date:'dd-MM-yyyy'}}</td>
                                <td>{{user.closingPrice}}</td>
                                <td>{{user.AdvPay + user.restAmount}}</td>
                                <td>{{user.remainingAmount}}</td>
                                <td>{{user.salesPerson}}</td>
                                <td>
                                    <select [(ngModel)]="user.projectStatus"
                                        (change)="updateEditorVisible = (user.projectStatus === 'closing'); updateEditors(user); highlightRow(i)">
                                        <option value="Not Interested">Not Interested</option>
                                        <option value="Interested">Interested</option>
                                        <option value="Closing">Closing</option>
                                        <option value="Scripting">Scripting</option>
                                        <option value="Script Correction">Script Correction</option>
                                        <option value="Voice Over">Voice Over</option>
                                        <option value="Video Editing">Video Editing</option>
                                        <option value="Video Changes">Video Changes</option>
                                        <option value="Video Done">Video Done</option>
                                        <option value="Payment Pending">Payment Pending</option>
                                        <option value="Completed">Completed</option>
                                    </select>
                                </td>
                                <td>
                                    <select
                                        *ngIf="user.projectStatus === 'Scripting' || user.projectStatus === 'Script Correction'"
                                        [(ngModel)]="user.scriptWriter" (change)="updateEditors(user)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Scripting')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                    <select
                                        *ngIf="user.projectStatus === 'Video Editing' || user.projectStatus === 'Video Changes' || user.projectStatus === 'Video Done' "
                                        [(ngModel)]="user.editor" (change)="updateEditors(user)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Video Editing')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                    <select *ngIf="user.projectStatus === 'Voice Over'" [(ngModel)]="user.voiceOver"
                                        (change)="updateEditors(user)">
                                        <option value="none">None</option>
                                        <option *ngFor="let employee of filterEmployeesByRole('Voice Over')"
                                            [value]="employee.signupUsername">
                                            {{employee.signupUsername}}
                                        </option>
                                    </select>
                                </td>
                                <td *ngIf="user.projectStatus === 'Scripting' || user.projectStatus === 'Script Correction'"
                                    [(ngModel)]="user.scriptWriter">
                                    {{user.scriptStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Video Editing' || user.projectStatus === 'Video Changes' || user.projectStatus === 'Video Done' "
                                    [(ngModel)]="user.editor">
                                    {{user.editorStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Voice Over'" [(ngModel)]="user.voiceOver">
                                    {{user.voiceOverStatus}}
                                </td>
                                <td *ngIf="user.projectStatus === 'Closing' || user.projectStatus === 'Completed'">
                                    {{user.projectStatus}}
                                </td>
                                <td>
                                    <select [(ngModel)]="user.priority" (change)="updatePriority(user,user.priority)">
                                        <option value="none">Select</option>
                                        <option value="Urgent">Urgent</option>
                                        <option value="High">High</option>
                                        <option value="Medium">Medium</option>
                                        <option value="Low">Low</option>
                                    </select>
                                </td>

                                <td>
                                    <div class="buttons">
                                        <button class="btn btn-sm btn-primary" (click)="openUpdatePanel(user._id)">
                                            View</button>
                                    </div>
                                </td>
                                <td> <button class="btn btn-sm btn-primary" (click)="invoice(user._id)">Create</button>
                                </td>
                            </tr>
                            <!-- Sub-entries row -->
                            <tr *ngIf="user.showSub" class="sub-entry-row">
                                <td colspan="19">
                                    <table class="table table-bordered sub-entry-table w-100">
                                        <thead>
                                            <tr>
                                                <th>Sub Code</th>
                                                <th>Name</th>
                                                <th>Type</th>
                                                <th scope="col">Project Status</th>
                                                <th scope="col">Select T.M</th>
                                                <th scope="col">T.M Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let sub of user.subEntries">
                                                <td>{{sub.custCode}}</td>
                                                <td>{{sub.custName}}</td>
                                                <td>{{sub.entryType}}</td>
                                                <td>
                                                    <select [(ngModel)]="sub.projectStatus"
                                                        (change)="updateEditorVisible = (user.projectStatus === 'closing'); updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="Not Interested">Not Interested</option>
                                                        <option value="Interested">Interested</option>
                                                        <option value="Closing">Closing</option>
                                                        <option value="Graphic Designing">Graphic Designing</option>
                                                        <option value="Graphic Designing Changes">Graphic Designing
                                                            Changes</option>
                                                        <option value="Scripting">Scripting</option>
                                                        <option value="Script Correction">Script Correction</option>
                                                        <option value="Voice Over">Voice Over</option>
                                                        <option value="Video Editing">Video Editing</option>
                                                        <option value="Video Changes">Video Changes</option>
                                                        <option value="Video Done">Video Done</option>
                                                        <option value="Payment Pending">Payment Pending</option>
                                                        <option value="Completed">Completed</option>
                                                    </select>
                                                </td>
                                                <td><select *ngIf="sub.projectStatus === 'Graphic Designing'"
                                                        [(ngModel)]="sub.graphicDesigner"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Graphic Designing')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select
                                                        *ngIf="sub.projectStatus === 'Scripting' || sub.projectStatus === 'Script Correction'"
                                                        [(ngModel)]="sub.scriptWriter"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Scripting')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select
                                                        *ngIf="sub.projectStatus === 'Video Editing' || sub.projectStatus === 'Video Changes' || sub.projectStatus === 'Video Done' "
                                                        [(ngModel)]="sub.editor"
                                                        (change)="updateSubEntryStatus(user,sub); highlightRow(i)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Video Editing')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                    <select *ngIf="sub.projectStatus === 'Voice Over'"
                                                        [(ngModel)]="sub.voiceOver"
                                                        (change)="updateSubEntryStatus(user,sub)">
                                                        <option value="none">None</option>
                                                        <option
                                                            *ngFor="let employee of filterEmployeesByRole('Voice Over')"
                                                            [value]="employee.signupUsername">
                                                            {{employee.signupUsername}}
                                                        </option>
                                                    </select>
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Scripting' || sub.projectStatus === 'Script Correction'"
                                                    [(ngModel)]="sub.scriptWriter">
                                                    {{sub.scriptStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Video Editing' || sub.projectStatus === 'Video Changes' || sub.projectStatus === 'Video Done' "
                                                    [(ngModel)]="sub.editor">
                                                    {{sub.editorStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Voice Over'"
                                                    [(ngModel)]="sub.voiceOver">
                                                    {{sub.voiceOverStatus}}
                                                </td>
                                                <td *ngIf="sub.projectStatus === 'Graphic Designing'"
                                                    [(ngModel)]="sub.graphicDesigner">
                                                    {{sub.graphicStatus}}
                                                </td>
                                                <td
                                                    *ngIf="sub.projectStatus === 'Closing' || sub.projectStatus === 'Completed'">
                                                    {{sub.projectStatus}}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </ng-container>
                    </tbody>
                </div>
            </div>
        </div>
    </div>
</div>